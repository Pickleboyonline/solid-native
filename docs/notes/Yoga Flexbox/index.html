<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yoga Flexbox</title>

    <meta name="supported-color-schemes" content="light dark">
    <meta name="theme-color" content="hsl(220, 20%, 100%)" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="hsl(220, 20%, 10%)" media="(prefers-color-scheme: dark)">

    <link rel="stylesheet" href="/solid-native/pagefind/pagefind-ui.css"><link rel="stylesheet" href="/solid-native/styles.css">
    <link rel="canonical" href="https://pickleboyonline.github.com/solid-native/notes/Yoga Flexbox/">
    
  <script type="text/javascript" src="/solid-native/pagefind/pagefind-ui.js"></script><script type="text/javascript">window.addEventListener('DOMContentLoaded',()=>{new PagefindUI({"element":"#search","showImages":false,"excerptLength":0,"showEmptyFilters":true,"showSubResults":false,"resetStyles":true,"bundlePath":"/solid-native/pagefind/","baseUrl":"/solid-native/"});});</script><link rel="icon" sizes="48x48" href="/solid-native/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="/solid-native/apple-touch-icon.png">
<link rel="icon" sizes="any" href="/solid-native/favicon.svg" type="image/svg+xml">
</head>

  <body>
    <div class="container">
      <div class="toolbar">
        <div id="search" class="search"></div>
        <script>
          let theme = localStorage.getItem("theme") || (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
          document.documentElement.dataset.theme = theme;
          function changeTheme() {
            theme = theme === "dark" ? "light" : "dark";
            localStorage.setItem("theme", theme);
            document.documentElement.dataset.theme = theme;
          }
        </script>
        <button class="button theme" onclick="changeTheme()">
          <span class="icon">‚óê</span>
        </button>
      </div>

      <nav class="menu-container">
  

  
    
      <a class="menu-highlight" href="/solid-native/">Solid Native</a>
    
  

  <ul class="menu">
  
    <li>
      


  <strong><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--color-dim)" viewbox="0 0 256 256"><path d="M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64l27.73,20.8a16.12,16.12,0,0,0,9.6,3.2H200v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"></path></svg></span> Components</strong>



<ul>
  
  <li>
    


  <a href="/solid-native/Components/Button/">
    
    üöß  Button
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/Components/Text/">
    
    üöß  Text
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/Components/View/">
    
    üöß View
  </a>




  </li>
  
</ul>


    </li>
  
    <li>
      


  <strong><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--color-dim)" viewbox="0 0 256 256"><path d="M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64l27.73,20.8a16.12,16.12,0,0,0,9.6,3.2H200v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"></path></svg></span> Props</strong>



<ul>
  
  <li>
    


  <a href="/solid-native/Props/Layout Props/">
    
    Layout Props
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/Props/Shadow Props/">
    
    Shadow Props
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/Props/Text Style Props/">
    
    Text Style Props
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/Props/View Style Props/">
    
    View Style Props
  </a>




  </li>
  
</ul>


    </li>
  
    <li>
      


  <strong><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="var(--color-dim)" viewbox="0 0 256 256"><path d="M245,110.64A16,16,0,0,0,232,104H216V88a16,16,0,0,0-16-16H130.67L102.94,51.2a16.14,16.14,0,0,0-9.6-3.2H40A16,16,0,0,0,24,64V208h0a8,8,0,0,0,8,8H211.1a8,8,0,0,0,7.59-5.47l28.49-85.47A16.05,16.05,0,0,0,245,110.64ZM93.34,64l27.73,20.8a16.12,16.12,0,0,0,9.6,3.2H200v16H69.77a16,16,0,0,0-15.18,10.94L40,158.7V64Zm112,136H43.1l26.67-80H232Z"></path></svg></span> notes</strong>



<ul>
  
  <li>
    


  <a href="/solid-native/notes/Expo-like Modules/">
    
    Expo-like Modules
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Module and Build System/">
    
    Module and Build System
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Modules System/">
    
    Modules System
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Navigation/">
    
    Navigation
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Overall Design/">
    
    Overall Design
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Refactors/">
    
    Refactors
  </a>




  </li>
  
  <li>
    


  <a href="/solid-native/notes/Text/">
    
    Text
  </a>




  </li>
  
  <li>
    


  <a aria-current="page" href="/solid-native/notes/Yoga Flexbox/">
    
    Yoga Flexbox
  </a>




  </li>
  
</ul>


    </li>
  
  </ul>
</nav>


      

      <main class="main">
        <nav>
  <ul class="breadcrumb">
    
    
    <li class="breadcrumb-item"><a href="/solid-native/">Solid Native</a></li>
    
    
    
    <li class="breadcrumb-item"><strong>notes</strong></li>
    
    
    
    
  </ul>
</nav>


        <div class="body">
          
            <h1>Yoga Flexbox</h1>
          

          
            <p>This task is done, below are just some notes.</p>
<hr>
<p>TODO: Essentially copy the way react fabric system works under the hood.
Important Links:</p>
<ul>
<li><a href="https://reactnative.dev/architecture/fabric-renderer">https://reactnative.dev/architecture/fabric-renderer</a></li>
<li><a href="https://www.yogalayout.dev/">https://www.yogalayout.dev/</a></li>
<li><a href="https://github.com/software-mansion-labs/react-native-swiftui/tree/master/packages/react-native-swiftui/native/Views">https://github.com/software-mansion-labs/react-native-swiftui/tree/master/packages/react-native-swiftui/native/Views</a></li>
<li><a href="https://github.com/software-mansion-labs/react-native-swiftui/tree/master">https://github.com/software-mansion-labs/react-native-swiftui/tree/master</a></li>
<li><a href="https://blog.swmansion.com/swiftui-renderer-for-react-native-2b62fda38c9b">https://blog.swmansion.com/swiftui-renderer-for-react-native-2b62fda38c9b</a></li>
<li><a href="https://blog.swmansion.com/swiftui-renderer-for-react-native-part-ii-161bad1d69e1">https://blog.swmansion.com/swiftui-renderer-for-react-native-part-ii-161bad1d69e1</a></li>
</ul>
<p>Essentially, when a style is placed on a node we call yoga to have a node for it. This may be a bit tricky considering SolidJS idology.</p>
<p>SolidJS works via mutations to the tree to update. But to render something, we need the information up front about the styles (one pass) on initial mount. Otherwise, we run into the problem of a view being present but no object is sent down.</p>
<p>I have not seen this visibly, but i am just saying it can cause problems.</p>
<p>React is better in that it knows the tree up front in every update the the VDOM. technically, my implimentation needs a VDOM of its own to manage the references to the views to update the props. However, as long as the system does it in one pass (SolidJS may group updates, im not exactly sure, because when i view somethings typically dont shift they render almost instantly.)</p>
<p>WAIT never mind SolidJS builds the updates before attatching the views anyways. That makes sense. OK, so we just need to call to YOGA when we MOUNT or UPDATE a PROP on a dirty component.</p>
<p>Because we are working with solid, we may be able to get some selectively out of this. In the render phase.</p>
<p>In this new layout system, every component is in a ZStack with its offset and frame ajusted to YOGA dimensions. so Yoga needs to calculate params. Where does this happen? Well, it can happen in the RENDER module. The render module is a singleton that dispatches commands to the components based on IDs.</p>
<p>So, the renderer will just need to maintain a yoga tree based on its methods. If a node has not been attachted, it will skip calculating layouts (i think yoga automatically does this, so your good.)</p>
<p>The only thing to worry about is batching updates after the initial mount. If the update happens via the styles object thats not bad since its just one object but if its outside of that than a performance hit can be observed. That can be worked on later, but for now, its not that bad and probably wont be that noticeable.</p>
<p>So the data flow looks like this:</p>
<p>SolidJS =&gt; SolidNativeRenderer =&gt; Yoga(yoga may call some native methods for text and device dimensions) =&gt; A layout object =&gt; SolidNativeView which uses its layout for flexbox.</p>
<p>In the SolidNativeRenderer, there needs to be something that recalculates the layout after each prop change if the component has mounted. If it hasn't mounted, wait until all its props have been updated (so really just calculate it when you draw it)</p>
<p>The code for determining the size of text or views can be derrived from ChatGPT and the Software mansion blog.</p>
<p>In terms of threading, all this is done on the main for now but we can move the solid native renderer prob on the background when performing Yoga layouts.</p>
<p>I wanted to avoid using UIKit because apparantly you cant use it for widgets or apple watch, but thats not that bad. If i do use pure swiftUI, some parts are just not that feasible like rendering offscreen components. You can <em>technically</em> do with with a hidden zstack but that means having to render things twice on the main thread with some trick sync issues. Overall, because SwiftUI is meant to be used declaratively means I have to determine everything upfront including the layout.</p>
<p>I could also just re-impliment the Yoga flexbox with SwiftUI native primatives but thats too much work in my opinion. ChatGPT probably wont be able to do something that complex so I cant rely on that either. Best option is just just repurpose Yoga, which should take a day or too, and i get the flexbox system for free basically.</p>

          
        </div>

        
      </main>

      
    </div>
  

</body></html>